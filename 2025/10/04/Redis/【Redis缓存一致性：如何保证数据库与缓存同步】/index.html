<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>ã€Redisç¼“å­˜ä¸€è‡´æ€§ï¼šå¦‚ä½•ä¿è¯æ•°æ®åº“ä¸ç¼“å­˜åŒæ­¥ã€‘ | æ˜“é”¦é£çš„åšå®¢</title><meta name="author" content="formeasy"><meta name="copyright" content="formeasy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ã€Redisç¼“å­˜ä¸€è‡´æ€§ï¼šå¦‚ä½•ä¿è¯æ•°æ®åº“ä¸ç¼“å­˜åŒæ­¥ã€‘"><meta property="og:type" content="article"><meta property="og:title" content="ã€Redisç¼“å­˜ä¸€è‡´æ€§ï¼šå¦‚ä½•ä¿è¯æ•°æ®åº“ä¸ç¼“å­˜åŒæ­¥ã€‘"><meta property="og:url" content="http://www.formeasy.cc/2025/10/04/Redis/%E3%80%90Redis%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E7%BC%93%E5%AD%98%E5%90%8C%E6%AD%A5%E3%80%91/index.html"><meta property="og:site_name" content="æ˜“é”¦é£çš„åšå®¢"><meta property="og:description" content="ã€Redisç¼“å­˜ä¸€è‡´æ€§ï¼šå¦‚ä½•ä¿è¯æ•°æ®åº“ä¸ç¼“å­˜åŒæ­¥ã€‘"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://www.formeasy.cc/2025/10/04/Redis/%E3%80%90Redis%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E7%BC%93%E5%AD%98%E5%90%8C%E6%AD%A5%E3%80%91/c1a02890a7ad4c8cb1d6d172adcdb820.png"><meta property="article:published_time" content="2025-10-04T08:11:24.000Z"><meta property="article:modified_time" content="2025-10-04T08:18:28.754Z"><meta property="article:author" content="formeasy"><meta property="article:tag" content="Redis"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://www.formeasy.cc/2025/10/04/Redis/%E3%80%90Redis%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E7%BC%93%E5%AD%98%E5%90%8C%E6%AD%A5%E3%80%91/c1a02890a7ad4c8cb1d6d172adcdb820.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://www.formeasy.cc/2025/10/04/Redis/%E3%80%90Redis%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E7%BC%93%E5%AD%98%E5%90%8C%E6%AD%A5%E3%80%91/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{var e={set:(e,t,a)=>{a&&(a=Date.now()+864e5*a,localStorage.setItem(e,JSON.stringify({value:t,expiry:a})))},get:e=>{var t=localStorage.getItem(e);if(t){var{value:t,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return t;localStorage.removeItem(e)}}},t=(window.btf={saveToLocal:e,getScript:(o,n={})=>new Promise((e,t)=>{const a=document.createElement("script");a.src=o,a.async=!0,Object.entries(n).forEach(([e,t])=>a.setAttribute(e,t)),a.onload=a.onreadystatechange=()=>{a.readyState&&!/loaded|complete/.test(a.readyState)||e()},a.onerror=t,document.head.appendChild(a)}),getCSS:(o,n)=>new Promise((e,t)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=o,n&&(a.id=n),a.onload=a.onreadystatechange=()=>{a.readyState&&!/loaded|complete/.test(a.readyState)||e()},a.onerror=t,document.head.appendChild(a)}),addGlobalFn:(e,t,a=!1,o=window)=>{var n;e.startsWith("pjax")||((n=o.globalFn||{})[e]=n[e]||{},n[e][a||Object.keys(n[e]).length]=t,o.globalFn=n)}},()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")}),a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")},o=(btf.activateDarkMode=t,btf.activateLightMode=a,e.get("theme")),t=("dark"===o?t():"light"===o&&a(),e.get("aside-status"));void 0!==t&&document.documentElement.classList.toggle("hide-aside","hide"===t);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,top_n_per_article:1,unescape:!1,languages:{hits_empty:"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}",hits_stats:"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1,highlightFullpage:!1,highlightMacStyle:!0},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶å¤±è´¥",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!1,post:!1},runtime:"",dateSuffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js",buttonText:"åŠ è½½æ›´å¤š"},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1,percent:{toc:!0,rightside:!1},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"ã€Redisç¼“å­˜ä¸€è‡´æ€§ï¼šå¦‚ä½•ä¿è¯æ•°æ®åº“ä¸ç¼“å­˜åŒæ­¥ã€‘",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,isShuoshuo:!1}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="æ˜“é”¦é£çš„åšå®¢" type="application/atom+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/butterfly-icon.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">251</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">40</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">11</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> èµ„æºé“¾æ¥</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äºæˆ‘ä»¬</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/2025/10/04/Redis/ã€Redisç¼“å­˜ä¸€è‡´æ€§ï¼šå¦‚ä½•ä¿è¯æ•°æ®åº“ä¸ç¼“å­˜åŒæ­¥ã€‘/c1a02890a7ad4c8cb1d6d172adcdb820.png)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" alt="Logo"><span class="site-name">æ˜“é”¦é£çš„åšå®¢</span></a><a class="nav-page-title" href="/"><span class="site-name">ã€Redisç¼“å­˜ä¸€è‡´æ€§ï¼šå¦‚ä½•ä¿è¯æ•°æ®åº“ä¸ç¼“å­˜åŒæ­¥ã€‘</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> èµ„æºé“¾æ¥</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äºæˆ‘ä»¬</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ã€Redisç¼“å­˜ä¸€è‡´æ€§ï¼šå¦‚ä½•ä¿è¯æ•°æ®åº“ä¸ç¼“å­˜åŒæ­¥ã€‘</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-10-04T08:11:24.000Z" title="å‘è¡¨äº 2025-10-04 16:11:24">2025-10-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-10-04T08:18:28.754Z" title="æ›´æ–°äº 2025-10-04 16:18:28">2025-10-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>14åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>ğŸ’¡ æ‘˜è¦ï¼šæ˜¯å¦é‡åˆ°è¿‡ç¼“å­˜æ•°æ®ä¸æ•°æ®åº“ä¸ä¸€è‡´çš„å°´å°¬å±€é¢ï¼Ÿæ˜¯å¦åœ¨æ•°æ®æ›´æ–°åå‘ç°ç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯æ—§æ•°æ®ï¼Ÿç¼“å­˜ä¸€è‡´æ€§æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ€å…·æŒ‘æˆ˜æ€§çš„é—®é¢˜ä¹‹ä¸€ï¼Œå®ƒç›´æ¥å½±å“åˆ°æ•°æ®çš„å‡†ç¡®æ€§å’Œç”¨æˆ·ä½“éªŒã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Redisç¼“å­˜ä¸€è‡´æ€§çš„å„ç§è§£å†³æ–¹æ¡ˆï¼Œä»ç®€å•çš„æ›´æ–°ç­–ç•¥åˆ°å¤æ‚çš„æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆï¼Œå¸®ä½ æ„å»ºå¯é çš„æ•°æ®åŒæ­¥ä½“ç³»ï¼</p><hr><h3 id="ä¸€-ç¼“å­˜ä¸€è‡´æ€§æŒ‘æˆ˜"><a class="markdownIt-Anchor" href="#ä¸€-ç¼“å­˜ä¸€è‡´æ€§æŒ‘æˆ˜"></a> ä¸€ã€ç¼“å­˜ä¸€è‡´æ€§æŒ‘æˆ˜</h3><h4 id="1-ä¸ºä»€ä¹ˆç¼“å­˜ä¸€è‡´æ€§å¾ˆéš¾"><a class="markdownIt-Anchor" href="#1-ä¸ºä»€ä¹ˆç¼“å­˜ä¸€è‡´æ€§å¾ˆéš¾"></a> 1. ä¸ºä»€ä¹ˆç¼“å­˜ä¸€è‡´æ€§å¾ˆéš¾ï¼Ÿ</h4><p><strong>å…¸å‹çš„ä¸ä¸€è‡´åœºæ™¯</strong>ï¼š</p><ul><li><p>ğŸ•’Â <strong>æ—¶åºé—®é¢˜</strong>ï¼šç¼“å­˜æ›´æ–°å’Œæ•°æ®åº“æ›´æ–°çš„é¡ºåº</p></li><li><p>âš¡Â <strong>å¹¶å‘å†²çª</strong>ï¼šå¤šä¸ªè¯·æ±‚åŒæ—¶æ›´æ–°åŒä¸€æ•°æ®</p></li><li><p>ğŸ”„Â <strong>æ“ä½œå¤±è´¥</strong>ï¼šä¸€ä¸ªæ“ä½œæˆåŠŸå¦ä¸€ä¸ªå¤±è´¥</p></li><li><p>ğŸ—‘ï¸Â <strong>ç¼“å­˜å¤±æ•ˆ</strong>ï¼šç¼“å­˜è¿‡æœŸæˆ–æ·˜æ±°å¯¼è‡´æ•°æ®ä¸ä¸€è‡´</p></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="c1a02890a7ad4c8cb1d6d172adcdb820.png" alt=""></p><h4 id="2-ä¸€è‡´æ€§çº§åˆ«å¯¹æ¯”"><a class="markdownIt-Anchor" href="#2-ä¸€è‡´æ€§çº§åˆ«å¯¹æ¯”"></a> 2. ä¸€è‡´æ€§çº§åˆ«å¯¹æ¯”</h4><table><thead><tr><th>ä¸€è‡´æ€§çº§åˆ«</th><th>æè¿°</th><th>æ€§èƒ½å½±å“</th><th>å®ç°å¤æ‚åº¦</th></tr></thead><tbody><tr><td><strong>å¼ºä¸€è‡´æ€§</strong></td><td>ä»»ä½•æ—¶åˆ»æ•°æ®ä¸€è‡´</td><td>é«˜</td><td>æé«˜</td></tr><tr><td><strong>æœ€ç»ˆä¸€è‡´æ€§</strong></td><td>ä¸€æ®µæ—¶é—´åæ•°æ®ä¸€è‡´</td><td>ä¸­</td><td>ä¸­</td></tr><tr><td><strong>å¼±ä¸€è‡´æ€§</strong></td><td>ä¸ä¿è¯æ•°æ®ä¸€è‡´</td><td>ä½</td><td>ä½</td></tr></tbody></table><h3 id="äºŒ-åŸºç¡€æ›´æ–°ç­–ç•¥"><a class="markdownIt-Anchor" href="#äºŒ-åŸºç¡€æ›´æ–°ç­–ç•¥"></a> äºŒã€åŸºç¡€æ›´æ–°ç­–ç•¥</h3><h4 id="1-cache-asideæ¨¡å¼æ—è·¯ç¼“å­˜"><a class="markdownIt-Anchor" href="#1-cache-asideæ¨¡å¼æ—è·¯ç¼“å­˜"></a> 1. Cache-Asideæ¨¡å¼ï¼ˆæ—è·¯ç¼“å­˜ï¼‰</h4><p><strong>æœ€å¸¸ç”¨çš„ç¼“å­˜æ¨¡å¼</strong>ï¼š</p><p>python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_user</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="comment"># 1. å…ˆæŸ¥ç¼“å­˜</span></span><br><span class="line">    user_data = redis.get(<span class="string">f&quot;user:<span class="subst">&#123;user_id&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> user_data:</span><br><span class="line">        <span class="keyword">return</span> user_data</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. ç¼“å­˜ä¸å­˜åœ¨ï¼ŒæŸ¥æ•°æ®åº“</span></span><br><span class="line">    user_data = db.query(<span class="string">&quot;SELECT * FROM users WHERE id = %s&quot;</span>, user_id)</span><br><span class="line">    <span class="keyword">if</span> user_data:</span><br><span class="line">        <span class="comment"># 3. å†™å…¥ç¼“å­˜</span></span><br><span class="line">        redis.setex(<span class="string">f&quot;user:<span class="subst">&#123;user_id&#125;</span>&quot;</span>, <span class="number">3600</span>, user_data)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> user_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_user</span>(<span class="params">user_id, new_data</span>):</span><br><span class="line">    <span class="comment"># 1. å…ˆæ›´æ–°æ•°æ®åº“</span></span><br><span class="line">    db.update(<span class="string">&quot;UPDATE users SET ... WHERE id = %s&quot;</span>, user_id, new_data)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. å†åˆ é™¤ç¼“å­˜</span></span><br><span class="line">    redis.delete(<span class="string">f&quot;user:<span class="subst">&#123;user_id&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p><strong>é—®é¢˜ï¼šå¹¶å‘æ›´æ–°å¯èƒ½å¯¼è‡´ä¸ä¸€è‡´</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="1873d601c2a84ae5880db7b618e8a520.png" alt=""></p><h4 id="2-write-throughæ¨¡å¼ç›´å†™"><a class="markdownIt-Anchor" href="#2-write-throughæ¨¡å¼ç›´å†™"></a> 2. Write-Throughæ¨¡å¼ï¼ˆç›´å†™ï¼‰</h4><p><strong>åŒæ­¥æ›´æ–°ç¼“å­˜å’Œæ•°æ®åº“</strong>ï¼š</p><p>python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WriteThroughCache</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, redis_client, db_client</span>):</span><br><span class="line">        self.redis = redis_client</span><br><span class="line">        self.db = db_client</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set</span>(<span class="params">self, key, value, expire=<span class="number">3600</span></span>):</span><br><span class="line">        <span class="comment"># 1. å…ˆæ›´æ–°æ•°æ®åº“</span></span><br><span class="line">        self.db.update_data(key, value)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. å†æ›´æ–°ç¼“å­˜</span></span><br><span class="line">        self.redis.setex(key, expire, value)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="comment"># ç›´æ¥è¯»ç¼“å­˜</span></span><br><span class="line">        <span class="keyword">return</span> self.redis.get(key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line">cache = WriteThroughCache(redis, db)</span><br><span class="line">cache.<span class="built_in">set</span>(<span class="string">&quot;user:1001&quot;</span>, user_data)</span><br></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹</strong>ï¼šä¿è¯å¼ºä¸€è‡´æ€§<br><strong>ç¼ºç‚¹</strong>ï¼šå†™æ€§èƒ½è¾ƒä½ï¼Œä¸é€‚åˆé«˜é¢‘å†™åœºæ™¯</p><h3 id="ä¸‰-æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#ä¸‰-æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ"></a> ä¸‰ã€æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ</h3><h4 id="1-å»¶è¿ŸåŒåˆ ç­–ç•¥"><a class="markdownIt-Anchor" href="#1-å»¶è¿ŸåŒåˆ ç­–ç•¥"></a> 1. å»¶è¿ŸåŒåˆ ç­–ç•¥</h4><p><strong>è§£å†³å¹¶å‘å†²çªçš„æ–¹æ¡ˆ</strong>ï¼š</p><p>python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">update_user_with_double_delete</span>(<span class="params">user_id, new_data</span>):</span><br><span class="line">    <span class="comment"># ç¬¬ä¸€æ¬¡åˆ é™¤ç¼“å­˜</span></span><br><span class="line">    redis.delete(<span class="string">f&quot;user:<span class="subst">&#123;user_id&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">    db.update(<span class="string">&quot;UPDATE users SET ... WHERE id = %s&quot;</span>, user_id, new_data)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å»¶è¿Ÿç¬¬äºŒæ¬¡åˆ é™¤</span></span><br><span class="line">    threading.Timer(<span class="number">1.0</span>, <span class="keyword">lambda</span>: redis.delete(<span class="string">f&quot;user:<span class="subst">&#123;user_id&#125;</span>&quot;</span>)).start()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_with_retry</span>(<span class="params">user_id, max_retries=<span class="number">3</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å¸¦é‡è¯•çš„æŸ¥è¯¢&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> attempt <span class="keyword">in</span> <span class="built_in">range</span>(max_retries):</span><br><span class="line">        user_data = redis.get(<span class="string">f&quot;user:<span class="subst">&#123;user_id&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> user_data:</span><br><span class="line">            <span class="keyword">return</span> user_data</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç¼“å­˜ä¸å­˜åœ¨ï¼ŒæŸ¥æ•°æ®åº“</span></span><br><span class="line">        user_data = db.query(<span class="string">&quot;SELECT * FROM users WHERE id = %s&quot;</span>, user_id)</span><br><span class="line">        <span class="keyword">if</span> user_data:</span><br><span class="line">            <span class="comment"># è®¾ç½®ç¼“å­˜</span></span><br><span class="line">            redis.setex(<span class="string">f&quot;user:<span class="subst">&#123;user_id&#125;</span>&quot;</span>, <span class="number">3600</span>, user_data)</span><br><span class="line">            <span class="keyword">return</span> user_data</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># çŸ­æš‚ç­‰å¾…åé‡è¯•</span></span><br><span class="line">        time.sleep(<span class="number">0.1</span> * (<span class="number">2</span> ** attempt))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure><h4 id="2-åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„å¼‚æ­¥æ›´æ–°"><a class="markdownIt-Anchor" href="#2-åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„å¼‚æ­¥æ›´æ–°"></a> 2. åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„å¼‚æ­¥æ›´æ–°</h4><p><strong>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼š</p><p>python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> kafka <span class="keyword">import</span> KafkaProducer</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CacheAsyncUpdater</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.producer = KafkaProducer(</span><br><span class="line">            bootstrap_servers=[<span class="string">&#x27;kafka1:9092&#x27;</span>, <span class="string">&#x27;kafka2:9092&#x27;</span>],</span><br><span class="line">            value_serializer=<span class="keyword">lambda</span> v: json.dumps(v).encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_user</span>(<span class="params">self, user_id, new_data</span>):</span><br><span class="line">        <span class="comment"># 1. åªæ›´æ–°æ•°æ®åº“</span></span><br><span class="line">        db.update(<span class="string">&quot;UPDATE users SET ... WHERE id = %s&quot;</span>, user_id, new_data)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. å‘é€ç¼“å­˜æ›´æ–°æ¶ˆæ¯</span></span><br><span class="line">        message = &#123;</span><br><span class="line">            <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;cache_update&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;key&#x27;</span>: <span class="string">f&quot;user:<span class="subst">&#123;user_id&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;data&#x27;</span>: new_data,</span><br><span class="line">            <span class="string">&#x27;timestamp&#x27;</span>: time.time()</span><br><span class="line">        &#125;</span><br><span class="line">        self.producer.send(<span class="string">&#x27;cache-updates&#x27;</span>, message)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¶ˆè´¹è€…ç«¯</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cache_update_consumer</span>():</span><br><span class="line">    consumer = KafkaConsumer(</span><br><span class="line">        <span class="string">&#x27;cache-updates&#x27;</span>,</span><br><span class="line">        bootstrap_servers=[<span class="string">&#x27;kafka1:9092&#x27;</span>, <span class="string">&#x27;kafka2:9092&#x27;</span>],</span><br><span class="line">        value_deserializer=<span class="keyword">lambda</span> m: json.loads(m.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> message <span class="keyword">in</span> consumer:</span><br><span class="line">        data = message.value</span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;cache_update&#x27;</span>:</span><br><span class="line">            <span class="comment"># æ›´æ–°ç¼“å­˜</span></span><br><span class="line">            redis.setex(data[<span class="string">&#x27;key&#x27;</span>], <span class="number">3600</span>, data[<span class="string">&#x27;data&#x27;</span>])</span><br></pre></td></tr></table></figure><h3 id="å››-å¼ºä¸€è‡´æ€§æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#å››-å¼ºä¸€è‡´æ€§æ–¹æ¡ˆ"></a> å››ã€å¼ºä¸€è‡´æ€§æ–¹æ¡ˆ</h3><h4 id="1-åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#1-åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ"></a> 1. åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ</h4><p><strong>ä½¿ç”¨2PCå®ç°å¼ºä¸€è‡´æ€§</strong>ï¼š</p><p>python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DistributedTransaction</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, redis_client, db_client</span>):</span><br><span class="line">        self.redis = redis_client</span><br><span class="line">        self.db = db_client</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_with_2pc</span>(<span class="params">self, key, new_data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ä¸¤é˜¶æ®µæäº¤æ›´æ–°&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># é˜¶æ®µä¸€ï¼šå‡†å¤‡</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># æ•°æ®åº“å‡†å¤‡</span></span><br><span class="line">            db_transaction = self.db.begin_transaction()</span><br><span class="line">            db_transaction.update(<span class="string">&quot;UPDATE users SET ... WHERE id = %s&quot;</span>, key.split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>], new_data)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Rediså‡†å¤‡ï¼ˆè®¾ç½®ä¸´æ—¶çŠ¶æ€ï¼‰</span></span><br><span class="line">            self.redis.setex(<span class="string">f&quot;lock:<span class="subst">&#123;key&#125;</span>&quot;</span>, <span class="number">30</span>, <span class="string">&quot;prepared&quot;</span>)</span><br><span class="line">            self.redis.setex(<span class="string">f&quot;temp:<span class="subst">&#123;key&#125;</span>&quot;</span>, <span class="number">30</span>, new_data)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># é˜¶æ®µäºŒï¼šæäº¤</span></span><br><span class="line">            db_transaction.commit()</span><br><span class="line">            self.redis.setex(key, <span class="number">3600</span>, new_data)</span><br><span class="line">            self.redis.delete(<span class="string">f&quot;lock:<span class="subst">&#123;key&#125;</span>&quot;</span>)</span><br><span class="line">            self.redis.delete(<span class="string">f&quot;temp:<span class="subst">&#123;key&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># å›æ»š</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;db_transaction&#x27;</span> <span class="keyword">in</span> <span class="built_in">locals</span>():</span><br><span class="line">                db_transaction.rollback()</span><br><span class="line">            self.redis.delete(<span class="string">f&quot;lock:<span class="subst">&#123;key&#125;</span>&quot;</span>)</span><br><span class="line">            self.redis.delete(<span class="string">f&quot;temp:<span class="subst">&#123;key&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span> e</span><br></pre></td></tr></table></figure><h4 id="2-åŸºäºbinlogçš„åŒæ­¥æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#2-åŸºäºbinlogçš„åŒæ­¥æ–¹æ¡ˆ"></a> 2. åŸºäºbinlogçš„åŒæ­¥æ–¹æ¡ˆ</h4><p><strong>ä½¿ç”¨MySQL binlogåŒæ­¥ç¼“å­˜</strong>ï¼š</p><p>python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysqlreplication</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BinlogSyncService</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, redis_client</span>):</span><br><span class="line">        self.redis = redis_client</span><br><span class="line">        self.setup_binlog_stream()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setup_binlog_stream</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®¾ç½®binlogç›‘å¬&quot;&quot;&quot;</span></span><br><span class="line">        stream = pymysqlreplication.BinLogStreamReader(</span><br><span class="line">            connection_settings=&#123;</span><br><span class="line">                <span class="string">&#x27;host&#x27;</span>: <span class="string">&#x27;mysql-master&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;port&#x27;</span>: <span class="number">3306</span>,</span><br><span class="line">                <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;repl&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;passwd&#x27;</span>: <span class="string">&#x27;password&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            server_id=<span class="number">100</span>,</span><br><span class="line">            blocking=<span class="literal">True</span>,</span><br><span class="line">            resume_stream=<span class="literal">True</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> binlogevent <span class="keyword">in</span> stream:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(binlogevent, WriteRowsEvent):</span><br><span class="line">                self.handle_write_event(binlogevent)</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(binlogevent, UpdateRowsEvent):</span><br><span class="line">                self.handle_update_event(binlogevent)</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(binlogevent, DeleteRowsEvent):</span><br><span class="line">                self.handle_delete_event(binlogevent)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_write_event</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†æ’å…¥äº‹ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> event.rows:</span><br><span class="line">            <span class="keyword">if</span> event.table == <span class="string">&#x27;users&#x27;</span>:</span><br><span class="line">                user_id = row[<span class="string">&#x27;values&#x27;</span>][<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">                redis_key = <span class="string">f&quot;user:<span class="subst">&#123;user_id&#125;</span>&quot;</span></span><br><span class="line">                self.redis.setex(redis_key, <span class="number">3600</span>, json.dumps(row[<span class="string">&#x27;values&#x27;</span>]))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_update_event</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†æ›´æ–°äº‹ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> event.rows:</span><br><span class="line">            <span class="keyword">if</span> event.table == <span class="string">&#x27;users&#x27;</span>:</span><br><span class="line">                user_id = row[<span class="string">&#x27;after_values&#x27;</span>][<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">                redis_key = <span class="string">f&quot;user:<span class="subst">&#123;user_id&#125;</span>&quot;</span></span><br><span class="line">                self.redis.setex(redis_key, <span class="number">3600</span>, json.dumps(row[<span class="string">&#x27;after_values&#x27;</span>]))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_delete_event</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†åˆ é™¤äº‹ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> event.rows:</span><br><span class="line">            <span class="keyword">if</span> event.table == <span class="string">&#x27;users&#x27;</span>:</span><br><span class="line">                user_id = row[<span class="string">&#x27;values&#x27;</span>][<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">                redis_key = <span class="string">f&quot;user:<span class="subst">&#123;user_id&#125;</span>&quot;</span></span><br><span class="line">                self.redis.delete(redis_key)</span><br></pre></td></tr></table></figure><h3 id="äº”-è¯»å†™åˆ†ç¦»åœºæ™¯çš„ä¸€è‡´æ€§"><a class="markdownIt-Anchor" href="#äº”-è¯»å†™åˆ†ç¦»åœºæ™¯çš„ä¸€è‡´æ€§"></a> äº”ã€è¯»å†™åˆ†ç¦»åœºæ™¯çš„ä¸€è‡´æ€§</h3><h4 id="1-ä¸»ä»å»¶è¿Ÿé—®é¢˜"><a class="markdownIt-Anchor" href="#1-ä¸»ä»å»¶è¿Ÿé—®é¢˜"></a> 1. ä¸»ä»å»¶è¿Ÿé—®é¢˜</h4><p><strong>è§£å†³ä¸»ä»å»¶è¿Ÿå¯¼è‡´çš„è„è¯»</strong>ï¼š</p><p>python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_with_read_after_write</span>(<span class="params">user_id, write_timestamp=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è¯»å†™åˆ†ç¦»ç¯å¢ƒä¸‹çš„ä¸€è‡´æ€§è¯»å–</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> write_timestamp:</span><br><span class="line">        <span class="comment"># æ£€æŸ¥ä¸»ä»å»¶è¿Ÿ</span></span><br><span class="line">        slave_lag = get_slave_lag()</span><br><span class="line">        <span class="keyword">if</span> time.time() - write_timestamp &amp;lt; slave_lag + <span class="number">1</span>:  <span class="comment"># é¢å¤–1ç§’ç¼“å†²</span></span><br><span class="line">            <span class="comment"># å¼ºåˆ¶è¯»ä¸»åº“</span></span><br><span class="line">            <span class="keyword">return</span> read_from_master(user_id)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å…ˆå°è¯•è¯»ä»åº“</span></span><br><span class="line">    user_data = read_from_slave(user_id)</span><br><span class="line">    <span class="keyword">if</span> user_data:</span><br><span class="line">        <span class="keyword">return</span> user_data</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä»åº“æ²¡æœ‰ï¼Œè¯»ä¸»åº“</span></span><br><span class="line">    <span class="keyword">return</span> read_from_master(user_id)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_from_master</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä»ä¸»åº“è¯»å–&quot;&quot;&quot;</span></span><br><span class="line">    user_data = db_master.query(<span class="string">&quot;SELECT * FROM users WHERE id = %s&quot;</span>, user_id)</span><br><span class="line">    <span class="keyword">if</span> user_data:</span><br><span class="line">        <span class="comment"># æ›´æ–°ç¼“å­˜</span></span><br><span class="line">        redis.setex(<span class="string">f&quot;user:<span class="subst">&#123;user_id&#125;</span>&quot;</span>, <span class="number">3600</span>, user_data)</span><br><span class="line">    <span class="keyword">return</span> user_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_from_slave</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä»ä»åº“è¯»å–&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> db_slave.query(<span class="string">&quot;SELECT * FROM users WHERE id = %s&quot;</span>, user_id)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_slave_lag</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è·å–ä»åº“å»¶è¿Ÿ&quot;&quot;&quot;</span></span><br><span class="line">    result = db_slave.query(<span class="string">&quot;SHOW SLAVE STATUS&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result[<span class="string">&#x27;Seconds_Behind_Master&#x27;</span>] <span class="keyword">if</span> result <span class="keyword">else</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="å…­-ç›‘æ§ä¸æ²»ç†"><a class="markdownIt-Anchor" href="#å…­-ç›‘æ§ä¸æ²»ç†"></a> å…­ã€ç›‘æ§ä¸æ²»ç†</h3><h4 id="1-ä¸€è‡´æ€§ç›‘æ§ä½“ç³»"><a class="markdownIt-Anchor" href="#1-ä¸€è‡´æ€§ç›‘æ§ä½“ç³»"></a> 1. ä¸€è‡´æ€§ç›‘æ§ä½“ç³»</h4><p><strong>ç›‘æ§å…³é”®æŒ‡æ ‡</strong>ï¼š</p><p>python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ConsistencyMonitor</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.metrics = &#123;</span><br><span class="line">            <span class="string">&#x27;cache_hits&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;cache_misses&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;stale_reads&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;consistency_errors&#x27;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_consistency</span>(<span class="params">self, key, db_data, cache_data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> db_data != cache_data:</span><br><span class="line">            self.metrics[<span class="string">&#x27;consistency_errors&#x27;</span>] += <span class="number">1</span></span><br><span class="line">            self._repair_inconsistency(key, db_data)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_repair_inconsistency</span>(<span class="params">self, key, correct_data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ä¿®å¤ä¸ä¸€è‡´æ•°æ®&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            redis.setex(key, <span class="number">3600</span>, correct_data)</span><br><span class="line">            logging.warning(<span class="string">f&quot;Repaired inconsistency for key: <span class="subst">&#123;key&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logging.error(<span class="string">f&quot;Failed to repair inconsistency: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">track_stale_read</span>(<span class="params">self, key, duration</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·Ÿè¸ªè¿‡æœŸæ•°æ®è¯»å–&quot;&quot;&quot;</span></span><br><span class="line">        self.metrics[<span class="string">&#x27;stale_reads&#x27;</span>] += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> duration &amp;gt; <span class="number">5</span>:  <span class="comment"># 5ç§’ä»¥ä¸Šçš„æ—§æ•°æ®</span></span><br><span class="line">            send_alert(<span class="string">f&quot;Stale data detected: <span class="subst">&#123;key&#125;</span>&quot;</span>, <span class="string">f&quot;Duration: <span class="subst">&#123;duration&#125;</span>s&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_report</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ç”Ÿæˆç›‘æ§æŠ¥å‘Š&quot;&quot;&quot;</span></span><br><span class="line">        total_requests = self.metrics[<span class="string">&#x27;cache_hits&#x27;</span>] + self.metrics[<span class="string">&#x27;cache_misses&#x27;</span>]</span><br><span class="line">        consistency_rate = <span class="number">1</span> - (self.metrics[<span class="string">&#x27;consistency_errors&#x27;</span>] / total_requests) <span class="keyword">if</span> total_requests &amp;gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;consistency_rate&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;consistency_rate:<span class="number">.3</span>%&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;stale_reads&#x27;</span>: self.metrics[<span class="string">&#x27;stale_reads&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;total_requests&#x27;</span>: total_requests</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="2-è‡ªåŠ¨ä¿®å¤æœºåˆ¶"><a class="markdownIt-Anchor" href="#2-è‡ªåŠ¨ä¿®å¤æœºåˆ¶"></a> 2. è‡ªåŠ¨ä¿®å¤æœºåˆ¶</h4><p><strong>ä¸ä¸€è‡´æ•°æ®è‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤</strong>ï¼š</p><p>python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AutoRepairService</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, redis_client, db_client</span>):</span><br><span class="line">        self.redis = redis_client</span><br><span class="line">        self.db = db_client</span><br><span class="line">        self.repair_queue = queue.Queue()</span><br><span class="line">        self.start_workers()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_workers</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¯åŠ¨ä¿®å¤å·¥ä½œçº¿ç¨‹&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):  <span class="comment"># 3ä¸ªä¿®å¤ worker</span></span><br><span class="line">            thread = threading.Thread(target=self._repair_worker)</span><br><span class="line">            thread.daemon = <span class="literal">True</span></span><br><span class="line">            thread.start()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_repair_worker</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ä¿®å¤å·¥ä½œçº¿ç¨‹&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                key = self.repair_queue.get()</span><br><span class="line">                self._repair_key(key)</span><br><span class="line">                self.repair_queue.task_done()</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logging.error(<span class="string">f&quot;Repair worker error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_repair_key</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ä¿®å¤å•ä¸ªkey&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># ä»æ•°æ®åº“è·å–æ­£ç¡®æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> key.startswith(<span class="string">&#x27;user:&#x27;</span>):</span><br><span class="line">            user_id = key.split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">            db_data = self.db.query(<span class="string">&quot;SELECT * FROM users WHERE id = %s&quot;</span>, user_id)</span><br><span class="line">            <span class="keyword">if</span> db_data:</span><br><span class="line">                <span class="comment"># æ›´æ–°ç¼“å­˜</span></span><br><span class="line">                self.redis.setex(key, <span class="number">3600</span>, db_data)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">schedule_repair</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è°ƒåº¦ä¿®å¤ä»»åŠ¡&quot;&quot;&quot;</span></span><br><span class="line">        self.repair_queue.put(key)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bulk_repair_check</span>(<span class="params">self, pattern=<span class="string">&quot;user:*&quot;</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ‰¹é‡æ£€æŸ¥ä¿®å¤&quot;&quot;&quot;</span></span><br><span class="line">        cursor = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            cursor, keys = self.redis.scan(cursor, <span class="keyword">match</span>=pattern, count=<span class="number">100</span>)</span><br><span class="line">            <span class="keyword">for</span> key <span class="keyword">in</span> keys:</span><br><span class="line">                self._verify_and_repair(key)</span><br><span class="line">            <span class="keyword">if</span> cursor == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_verify_and_repair</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;éªŒè¯å¹¶ä¿®å¤æ•°æ®&quot;&quot;&quot;</span></span><br><span class="line">        cache_data = self.redis.get(key)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cache_data:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è·å–æ•°æ®åº“æ•°æ®å¯¹æ¯”</span></span><br><span class="line">        <span class="keyword">if</span> key.startswith(<span class="string">&#x27;user:&#x27;</span>):</span><br><span class="line">            user_id = key.split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">            db_data = self.db.query(<span class="string">&quot;SELECT * FROM users WHERE id = %s&quot;</span>, user_id)</span><br><span class="line">            <span class="keyword">if</span> db_data != cache_data:</span><br><span class="line">                self.schedule_repair(key)</span><br></pre></td></tr></table></figure><h3 id="ä¸ƒ-åœºæ™¯åŒ–è§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#ä¸ƒ-åœºæ™¯åŒ–è§£å†³æ–¹æ¡ˆ"></a> ä¸ƒã€åœºæ™¯åŒ–è§£å†³æ–¹æ¡ˆ</h3><h4 id="1-ç”µå•†å•†å“åº“å­˜ä¸€è‡´æ€§"><a class="markdownIt-Anchor" href="#1-ç”µå•†å•†å“åº“å­˜ä¸€è‡´æ€§"></a> 1. ç”µå•†å•†å“åº“å­˜ä¸€è‡´æ€§</h4><p>python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">InventoryService</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.redis = redis.Redis()</span><br><span class="line">        self.db = database.Connection()</span><br><span class="line">        self.lock = redis.Redis()  <span class="comment"># ç”¨äºåˆ†å¸ƒå¼é”</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrease_stock</span>(<span class="params">self, product_id, quantity</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å‡å°‘åº“å­˜ï¼ˆä¿è¯ä¸€è‡´æ€§ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">        lock_key = <span class="string">f&quot;lock:stock:<span class="subst">&#123;product_id&#125;</span>&quot;</span></span><br><span class="line">        cache_key = <span class="string">f&quot;stock:<span class="subst">&#123;product_id&#125;</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è·å–åˆ†å¸ƒå¼é”</span></span><br><span class="line">        <span class="keyword">with</span> self._acquire_lock(lock_key):</span><br><span class="line">            <span class="comment"># æ£€æŸ¥ç¼“å­˜åº“å­˜</span></span><br><span class="line">            cache_stock = self.redis.get(cache_key)</span><br><span class="line">            <span class="keyword">if</span> cache_stock <span class="keyword">and</span> <span class="built_in">int</span>(cache_stock) &amp;lt; quantity:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">            self.db.update(</span><br><span class="line">                <span class="string">&quot;UPDATE products SET stock = stock - %s WHERE id = %s AND stock &amp;gt;= %s&quot;</span>,</span><br><span class="line">                quantity, product_id, quantity</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ›´æ–°ç¼“å­˜</span></span><br><span class="line">            <span class="keyword">if</span> cache_stock:</span><br><span class="line">                new_stock = <span class="built_in">int</span>(cache_stock) - quantity</span><br><span class="line">                self.redis.setex(cache_key, <span class="number">3600</span>, <span class="built_in">str</span>(new_stock))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># ç¼“å­˜ä¸å­˜åœ¨ï¼Œåˆ é™¤ä»¥ç¡®ä¿ä¸‹æ¬¡ä»æ•°æ®åº“åŠ è½½</span></span><br><span class="line">                self.redis.delete(cache_key)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_stock</span>(<span class="params">self, product_id</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–åº“å­˜ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">        cache_key = <span class="string">f&quot;stock:<span class="subst">&#123;product_id&#125;</span>&quot;</span></span><br><span class="line">        stock = self.redis.get(cache_key)</span><br><span class="line">        <span class="keyword">if</span> stock:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">int</span>(stock)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ä»æ•°æ®åº“è·å–</span></span><br><span class="line">        stock = self.db.query(<span class="string">&quot;SELECT stock FROM products WHERE id = %s&quot;</span>, product_id)</span><br><span class="line">        <span class="keyword">if</span> stock <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.redis.setex(cache_key, <span class="number">3600</span>, <span class="built_in">str</span>(stock))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> stock</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_acquire_lock</span>(<span class="params">self, lock_key, timeout=<span class="number">10</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–åˆ†å¸ƒå¼é”&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># å®ç°åˆ†å¸ƒå¼é”é€»è¾‘</span></span><br><span class="line">        identifier = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line">        end = time.time() + timeout</span><br><span class="line">        <span class="keyword">while</span> time.time() &amp;lt; end:</span><br><span class="line">            <span class="keyword">if</span> self.lock.<span class="built_in">set</span>(lock_key, identifier, nx=<span class="literal">True</span>, ex=<span class="number">5</span>):</span><br><span class="line">                <span class="keyword">return</span> identifier</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;è·å–é”è¶…æ—¶&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="2-é‡‘èè´¦æˆ·ä½™é¢ä¸€è‡´æ€§"><a class="markdownIt-Anchor" href="#2-é‡‘èè´¦æˆ·ä½™é¢ä¸€è‡´æ€§"></a> 2. é‡‘èè´¦æˆ·ä½™é¢ä¸€è‡´æ€§</h4><p>python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AccountService</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.redis = redis.Redis()</span><br><span class="line">        self.db = database.Connection()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">transfer</span>(<span class="params">self, from_account, to_account, amount</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è½¬è´¦æ“ä½œï¼ˆå¼ºä¸€è‡´æ€§è¦æ±‚ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§</span></span><br><span class="line">        <span class="keyword">with</span> self.db.transaction():</span><br><span class="line">            <span class="comment"># æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">            self.db.update(</span><br><span class="line">                <span class="string">&quot;UPDATE accounts SET balance = balance - %s WHERE id = %s AND balance &amp;gt;= %s&quot;</span>,</span><br><span class="line">                amount, from_account, amount</span><br><span class="line">            )</span><br><span class="line">            self.db.update(</span><br><span class="line">                <span class="string">&quot;UPDATE accounts SET balance = balance + %s WHERE id = %s&quot;</span>,</span><br><span class="line">                amount, to_account</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># åˆ é™¤ç›¸å…³ç¼“å­˜</span></span><br><span class="line">            self.redis.delete(<span class="string">f&quot;account:<span class="subst">&#123;from_account&#125;</span>&quot;</span>)</span><br><span class="line">            self.redis.delete(<span class="string">f&quot;account:<span class="subst">&#123;to_account&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># è®°å½•äº¤æ˜“æ—¥å¿—</span></span><br><span class="line">            self._log_transaction(from_account, to_account, amount)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_balance</span>(<span class="params">self, account_id</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–ä½™é¢ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">        cache_key = <span class="string">f&quot;account:<span class="subst">&#123;account_id&#125;</span>&quot;</span></span><br><span class="line">        balance = self.redis.get(cache_key)</span><br><span class="line">        <span class="keyword">if</span> balance:</span><br><span class="line">            <span class="keyword">return</span> decimal.Decimal(balance)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ä»æ•°æ®åº“è·å–</span></span><br><span class="line">        balance = self.db.query(<span class="string">&quot;SELECT balance FROM accounts WHERE id = %s&quot;</span>, account_id)</span><br><span class="line">        <span class="keyword">if</span> balance <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># å¼‚æ­¥æ›´æ–°ç¼“å­˜</span></span><br><span class="line">            threading.Thread(</span><br><span class="line">                target=self.redis.setex,</span><br><span class="line">                args=(cache_key, <span class="number">300</span>, <span class="built_in">str</span>(balance))</span><br><span class="line">            ).start()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> balance</span><br></pre></td></tr></table></figure><h3 id="å…«-æ€»ç»“ä¸æœ€ä½³å®è·µ"><a class="markdownIt-Anchor" href="#å…«-æ€»ç»“ä¸æœ€ä½³å®è·µ"></a> å…«ã€æ€»ç»“ä¸æœ€ä½³å®è·µ</h3><h4 id="ä¸€è‡´æ€§æ–¹æ¡ˆé€‰æ‹©æŒ‡å—"><a class="markdownIt-Anchor" href="#ä¸€è‡´æ€§æ–¹æ¡ˆé€‰æ‹©æŒ‡å—"></a> ä¸€è‡´æ€§æ–¹æ¡ˆé€‰æ‹©æŒ‡å—</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="db541323ce40494a994076ba3cd5de0c.png" alt=""></p><h4 id="æœ€ä½³å®è·µ-checklist"><a class="markdownIt-Anchor" href="#æœ€ä½³å®è·µ-checklist"></a> æœ€ä½³å®è·µ checklist âœ…</h4><p><strong>è®¾è®¡é˜¶æ®µ</strong>ï¼š</p><ul><li><p>æ˜ç¡®ä¸šåŠ¡çš„ä¸€è‡´æ€§è¦æ±‚</p></li><li><p>é€‰æ‹©åˆé€‚çš„ä¸€è‡´æ€§çº§åˆ«</p></li><li><p>è®¾è®¡ç¼“å­˜æ›´æ–°ç­–ç•¥</p></li><li><p>è§„åˆ’ç›‘æ§å’Œä¿®å¤æœºåˆ¶</p></li></ul><p><strong>å¼€å‘é˜¶æ®µ</strong>ï¼š</p><ul><li><p>å®ç°é€‚å½“çš„é‡è¯•æœºåˆ¶</p></li><li><p>æ·»åŠ åˆ†å¸ƒå¼é”é¿å…å¹¶å‘å†²çª</p></li><li><p>è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´</p></li><li><p>å®ç°æ•°æ®éªŒè¯å’Œä¿®å¤</p></li></ul><p><strong>è¿ç»´é˜¶æ®µ</strong>ï¼š</p><ul><li><p>ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡å’Œä¸€è‡´æ€§</p></li><li><p>è®¾ç½®å‘Šè­¦æœºåˆ¶</p></li><li><p>å®šæœŸè¿›è¡Œä¸€è‡´æ€§æ£€æŸ¥</p></li><li><p>å‡†å¤‡åº”æ€¥é¢„æ¡ˆ</p></li></ul><h4 id="å…³é”®å»ºè®®"><a class="markdownIt-Anchor" href="#å…³é”®å»ºè®®"></a> å…³é”®å»ºè®® ğŸš€</h4><ol><li><p><strong>ä¸è¦è¿‡åº¦è®¾è®¡</strong>ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©é€‚å½“çš„ä¸€è‡´æ€§çº§åˆ«</p></li><li><p><strong>ç›‘æ§é‡äºé¢„é˜²</strong>ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»æ¯”è¿½æ±‚å®Œç¾æ–¹æ¡ˆæ›´é‡è¦</p></li><li><p><strong>è®¾è®¡å®¹é”™æœºåˆ¶</strong>ï¼šå‡è®¾ä¸ä¸€è‡´ä¼šå‘ç”Ÿï¼Œå‡†å¤‡å¥½ä¿®å¤æ–¹æ¡ˆ</p></li><li><p><strong>æŒç»­ä¼˜åŒ–æ”¹è¿›</strong>ï¼šæ ¹æ®ç›‘æ§æ•°æ®ä¸æ–­è°ƒæ•´å’Œä¼˜åŒ–ç­–ç•¥</p></li></ol><p>é€šè¿‡æœ¬æ–‡çš„è¯¦ç»†åˆ†æå’Œå®è·µæ–¹æ¡ˆï¼Œä½ åº”è¯¥èƒ½å¤Ÿæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç¼“å­˜ä¸€è‡´æ€§æ–¹æ¡ˆï¼Œå¹¶æ„å»ºå‡ºå¯é çš„æ•°æ®åŒæ­¥ä½“ç³»ã€‚è®°ä½ï¼šä¸€è‡´æ€§æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§çš„è§£å†³æ–¹æ¡ˆï¼</p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://www.formeasy.cc">formeasy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://www.formeasy.cc/2025/10/04/Redis/%E3%80%90Redis%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E7%BC%93%E5%AD%98%E5%90%8C%E6%AD%A5%E3%80%91/">http://www.formeasy.cc/2025/10/04/Redis/ã€Redisç¼“å­˜ä¸€è‡´æ€§ï¼šå¦‚ä½•ä¿è¯æ•°æ®åº“ä¸ç¼“å­˜åŒæ­¥ã€‘/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="http://www.formeasy.cc" target="_blank">æ˜“é”¦é£çš„åšå®¢</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/">Redis</a></div><div class="post-share"><div class="social-share" data-image="/2025/10/04/Redis/%E3%80%90Redis%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E7%BC%93%E5%AD%98%E5%90%8C%E6%AD%A5%E3%80%91/c1a02890a7ad4c8cb1d6d172adcdb820.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/10/05/MySQL/SQL%20%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A%E4%BB%8E%E6%85%A2%E6%9F%A5%E8%AF%A2%E5%88%B0%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/" title="SQL ä¼˜åŒ–å®æˆ˜æ¡ˆä¾‹ï¼šä»æ…¢æŸ¥è¯¢åˆ°é«˜æ€§èƒ½çš„å®Œæ•´æŒ‡å—"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">SQL ä¼˜åŒ–å®æˆ˜æ¡ˆä¾‹ï¼šä»æ…¢æŸ¥è¯¢åˆ°é«˜æ€§èƒ½çš„å®Œæ•´æŒ‡å—</div></div><div class="info-2"><div class="info-item-1">ğŸ“Š ä¸€ã€å¸¸è§ SQL æ€§èƒ½é—®é¢˜æ¦‚è§ˆ ğŸš¨ ç”Ÿäº§ç¯å¢ƒæ€§èƒ½é—®é¢˜åˆ†å¸ƒ æ ¹æ®å¯¹ 1000+ ç”Ÿäº§ç¯å¢ƒæ…¢æŸ¥è¯¢çš„åˆ†æï¼Œå¸¸è§é—®é¢˜æ¯”ä¾‹å¦‚ä¸‹ï¼š ç´¢å¼•é—®é¢˜ï¼š45% JOINä¼˜åŒ–ï¼š25% å…¨è¡¨æ‰«æï¼š15% é”ç«äº‰ï¼š10% å…¶å®ƒï¼š5% ğŸ“ˆ æ€§èƒ½é—®é¢˜ç—‡çŠ¶è¯†åˆ« å¿«é€Ÿè¯Šæ–­æŒ‡æ ‡ï¼š æŸ¥è¯¢æ—¶é—´ &gt; 1ç§’ï¼šéœ€è¦ä¼˜åŒ– æ‰«æè¡Œæ•° &gt; 10000è¡Œï¼šç´¢å¼•å¯èƒ½å¤±æ•ˆ ä¸´æ—¶è¡¨ä½¿ç”¨ï¼šéœ€è¦ä¼˜åŒ–æŸ¥è¯¢æˆ–ç´¢å¼• æ–‡ä»¶æ’åºï¼šæ·»åŠ åˆé€‚çš„ç´¢å¼• âš¡ äºŒã€æ¡ˆä¾‹ä¸€ï¼šæ…¢æŸ¥è¯¢ä¼˜åŒ–å®æˆ˜ ğŸ¯ é—®é¢˜åœºæ™¯ï¼šç”µå•†è®¢å•æŸ¥è¯¢ç¼“æ…¢ åŸå§‹æ…¢æŸ¥è¯¢ï¼ˆæ‰§è¡Œæ—¶é—´ï¼š3.2ç§’ï¼‰ï¼š 123456SELECT * FROM orders WHERE user_id = 1001 AND order_date BETWEEN &#x27;2023-01-01&#x27; AND &#x27;2023-12-31&#x27; AND status IN (&#x27;completed&#x27;, &#x27;shipped&#x27;)ORDER BY order_date DESCLIMIT 100; ğŸ”...</div></div></div></a><a class="pagination-related" href="/2025/10/03/Elasticsearch/Elasticsearch%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AF%A6%E7%BB%86%E6%80%BB%E7%BB%93/" title="ElasticsearchçŸ¥è¯†ç‚¹è¯¦ç»†æ€»ç»“"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">ElasticsearchçŸ¥è¯†ç‚¹è¯¦ç»†æ€»ç»“</div></div><div class="info-2"><div class="info-item-1">Elasticsearchï¼ˆç®€ç§° ESï¼‰æ˜¯ä¸€æ¬¾åŸºäº Lucene æ„å»ºçš„åˆ†å¸ƒå¼ã€é«˜æ‰©å±•ã€é«˜å®æ—¶çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ Elastic Stackï¼ˆELK Stackï¼šElasticsearch, Logstash, Kibanaï¼‰çš„æ ¸å¿ƒç»„ä»¶ï¼Œå¹¿æ³›åº”ç”¨äºæ—¥å¿—åˆ†æã€å…¨æ–‡æ£€ç´¢ã€å®æ—¶æ•°æ®åˆ†æç­‰åœºæ™¯ã€‚æœ¬æ–‡å°†ä»æ ¸å¿ƒæ¦‚å¿µã€æ¶æ„è®¾è®¡ã€æ•°æ®æ“ä½œã€æŸ¥è¯¢åˆ†æã€æ€§èƒ½ä¼˜åŒ–ç­‰ç»´åº¦è¿›è¡Œå…¨é¢æ€»ç»“ã€‚ ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ Elasticsearch çš„æ¦‚å¿µä½“ç³»ä¸ä¼ ç»Ÿæ•°æ®åº“æœ‰æ˜¾è‘—å·®å¼‚ï¼Œç†è§£è¿™äº›åŸºç¡€æ¦‚å¿µæ˜¯æŒæ¡ ES çš„å‰æã€‚ 1. ä¸ä¼ ç»Ÿæ•°æ®åº“çš„å¯¹åº”å…³ç³» ä¸ºä¾¿äºå¿«é€Ÿç†è§£ï¼Œå¯å°† ES æ ¸å¿ƒæ¦‚å¿µä¸å…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰è¿›è¡Œç±»æ¯”ï¼š Elasticsearch æ¦‚å¿µ å…³ç³»å‹æ•°æ®åº“æ¦‚å¿µ è¯´æ˜ Indexï¼ˆç´¢å¼•ï¼‰ Databaseï¼ˆæ•°æ®åº“ï¼‰ å­˜å‚¨åŒç±»æ–‡æ¡£çš„é›†åˆï¼Œå…·æœ‰ç›¸ä¼¼çš„ç»“æ„ Typeï¼ˆç±»å‹ï¼Œ7.x ååºŸå¼ƒï¼‰ Tableï¼ˆè¡¨ï¼‰ æ—©æœŸç”¨äºå¯¹ Index å†…æ–‡æ¡£åˆ†ç±»ï¼Œ7.x èµ·å¼ºåˆ¶ä¸º _doc Documentï¼ˆæ–‡æ¡£ï¼‰ Rowï¼ˆè¡Œï¼‰ ç´¢å¼•ä¸­æœ€å°çš„æ•°æ®å•å…ƒï¼Œä»¥ JSON...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/10/05/Redis/Redis%20%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6%E8%A7%A3%E6%9E%90/" title="Redis åŒæ­¥æœºåˆ¶è§£æ"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-05</div><div class="info-item-2">Redis åŒæ­¥æœºåˆ¶è§£æ</div></div><div class="info-2"><div class="info-item-1">ä¸€ã€Redis åŒæ­¥æœºåˆ¶çš„æ ¸å¿ƒä¸ä»·å€¼ 1.1 æ ¸å¿ƒéœ€æ±‚ï¼šæ•°æ®å¤‡ä»½ä¸è¯»å†™åˆ†ç¦» æ•°æ®å¤‡ä»½ åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå•æœºRediså®ä¾‹å­˜åœ¨å¤šç§é£é™©ï¼š æœåŠ¡å™¨ç¡¬ä»¶æ•…éšœå¯¼è‡´æ•°æ®æ°¸ä¹…ä¸¢å¤± æ“ä½œç³»ç»Ÿå´©æºƒå¯¼è‡´å†…å­˜æ•°æ®æœªæŒä¹…åŒ– è¯¯æ“ä½œåˆ é™¤å…³é”®æ•°æ® é€šè¿‡åŒæ­¥æœºåˆ¶å»ºç«‹ä¸»ä»æ¶æ„ï¼Œå¯ä»¥å®ç°ï¼š å¤šå‰¯æœ¬å­˜å‚¨ï¼šæ•°æ®è‡³å°‘å­˜åœ¨äº2ä¸ªèŠ‚ç‚¹ï¼ˆ1ä¸»1ä»ï¼‰ï¼Œå…¸å‹é…ç½®ä¸º1ä¸»2ä» å®¹ç¾æ¢å¤ï¼šå½“ä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œå¯å¿«é€Ÿæå‡ä»èŠ‚ç‚¹ä¸ºæ–°ä¸»èŠ‚ç‚¹ æ•°æ®æŒä¹…åŒ–ä¿éšœï¼šç»“åˆRDBå’ŒAOFæŒä¹…åŒ–ç­–ç•¥ï¼Œå³ä½¿ä¸»èŠ‚ç‚¹å®Œå…¨æŸåï¼Œä»èŠ‚ç‚¹ä¹Ÿèƒ½æä¾›å®Œæ•´çš„æ•°æ®æ¢å¤ç‚¹ ç¤ºä¾‹åœºæ™¯ï¼šç”µå•†å¹³å°å•†å“åº“å­˜æ•°æ®ï¼Œé€šè¿‡åŒæ­¥æœºåˆ¶ç¡®ä¿å³ä½¿ä¸»èŠ‚ç‚¹å®•æœºï¼Œä»èŠ‚ç‚¹ä¹Ÿèƒ½ç»§ç»­æä¾›æœåŠ¡ï¼Œé¿å…è¶…å–ã€‚ è¯»å†™åˆ†ç¦» Redisçš„ä¸»ä»æ¶æ„å¤©ç„¶æ”¯æŒè¯»å†™åˆ†ç¦»ï¼š ä¸»èŠ‚ç‚¹(Master)ï¼šå¤„ç†æ‰€æœ‰å†™å…¥æ“ä½œï¼ˆSET, INCRç­‰ï¼‰å’Œéƒ¨åˆ†å…³é”®è¯»è¯·æ±‚ ä»èŠ‚ç‚¹(Slave)ï¼šå¤„ç†90%ä»¥ä¸Šçš„è¯»è¯·æ±‚ï¼ˆGET,...</div></div></div></a><a class="pagination-related" href="/2025/10/05/Redis/Redis%20%E8%A7%A3%E9%94%81%EF%BC%9AC++%20%E5%AE%9E%E6%88%98%E6%B7%B1%E5%BA%A6%E6%8E%A2%E7%B4%A2%20Set%20%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="Redis è§£é”ï¼šC++ å®æˆ˜æ·±åº¦æ¢ç´¢ Set æ•°æ®ç±»å‹"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/10/05/Redis/Redis%20%E8%A7%A3%E9%94%81%EF%BC%9AC++%20%E5%AE%9E%E6%88%98%E6%B7%B1%E5%BA%A6%E6%8E%A2%E7%B4%A2%20Set%20%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/ecfbf686c86c863f90654a62651e1aeb.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-05</div><div class="info-item-2">Redis è§£é”ï¼šC++ å®æˆ˜æ·±åº¦æ¢ç´¢ Set æ•°æ®ç±»å‹</div></div><div class="info-2"><div class="info-item-1">å‰è¨€ æ¬¢è¿æ¥åˆ° Redis Set çš„ç»ˆææŒ‡å—ã€‚å¦‚æœæ‚¨æ›¾éœ€è¦ç®¡ç†ä¸€ç»„ç‹¬ä¸€æ— äºŒçš„å…ƒç´ é›†åˆâ€”â€”æ— è®ºæ˜¯ç”¨æˆ· IDã€æ–‡ç« æ ‡ç­¾è¿˜æ˜¯é‚®ä»¶åœ°å€â€”â€”å¹¶å¸Œæœ›ä»¥é—ªç”µèˆ¬çš„é€Ÿåº¦å¯¹å…¶æ‰§è¡Œå¼ºå¤§çš„é›†åˆè¿ç®—ï¼Œé‚£ä¹ˆæ‚¨æ¥å¯¹åœ°æ–¹äº†ã€‚Redis Set ç»ä¸æ˜¯ä¸€ä¸ªç®€å•çš„åˆ—è¡¨ï¼Œå®ƒæ˜¯ä¸€ç§ç²¾å¦™çš„æ•°æ®ç»“æ„ï¼Œå°†æ•°å­¦ä¸­å¼ºå¤§çš„é›†åˆç†è®ºç›´æ¥å¸¦å…¥æ‚¨çš„é«˜æ€§èƒ½æ•°æ®åº“ä¸­ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»æœ€åŸºç¡€çš„æ¦‚å¿µè®²èµ·ï¼Œé€æ­¥æ·±å…¥åˆ°é«˜çº§çš„å®é™…åº”ç”¨ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¼˜ç§€çš„ C++ åº“ redis-plus-plus æ¥æ¼”ç¤ºæ‰€æœ‰ç¤ºä¾‹ï¼Œå¹¶é€è¡Œå‰–æä»£ç ã€‚æ— è®ºæ‚¨æ˜¯ C++ å¼€å‘è€…ã€åç«¯å·¥ç¨‹å¸ˆï¼Œè¿˜æ˜¯ä»…ä»…å¯¹ Redis æ„Ÿåˆ°å¥½å¥‡ï¼Œè¯»å®Œæœ¬æ–‡ï¼Œæ‚¨éƒ½å°†æ·±åˆ»ç†è§£æ˜¯ä»€ä¹ˆè®© Set æˆä¸º Redis ä¸­åŠŸèƒ½æœ€ä¸°å¯Œçš„å·¥å…·ä¹‹ä¸€ã€‚ Redis Set...</div></div></div></a><a class="pagination-related" href="/2025/08/20/Redis/Redis%E5%85%A5%E9%97%A8%E4%B8%8E%E8%83%8C%E6%99%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%9E%84%E5%BB%BA%E9%AB%98%E5%B9%B6%E5%8F%91%E3%80%81%E9%AB%98%E5%8F%AF%E7%94%A8%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%85%B3%E9%94%AE%E5%9F%BA%E7%9F%B3/" title="Rediså…¥é—¨ä¸èƒŒæ™¯è¯¦è§£ï¼šæ„å»ºé«˜å¹¶å‘ã€é«˜å¯ç”¨ç³»ç»Ÿçš„å…³é”®åŸºçŸ³"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/08/20/Redis/Redis%E5%85%A5%E9%97%A8%E4%B8%8E%E8%83%8C%E6%99%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%9E%84%E5%BB%BA%E9%AB%98%E5%B9%B6%E5%8F%91%E3%80%81%E9%AB%98%E5%8F%AF%E7%94%A8%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%85%B3%E9%94%AE%E5%9F%BA%E7%9F%B3/b7db0fbbbabea55259138d69bb08ddc2.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">Rediså…¥é—¨ä¸èƒŒæ™¯è¯¦è§£ï¼šæ„å»ºé«˜å¹¶å‘ã€é«˜å¯ç”¨ç³»ç»Ÿçš„å…³é”®åŸºçŸ³</div></div><div class="info-2"><div class="info-item-1">å‰è¨€ åœ¨å½“ä»Šè¿™ä¸ªæ•°æ®é©±åŠ¨çš„æ—¶ä»£ï¼Œåº”ç”¨çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§å·²æˆä¸ºè¡¡é‡å…¶æˆåŠŸçš„å…³é”®æŒ‡æ ‡ã€‚å½“ä¼ ç»Ÿçš„å•æœºæ¶æ„é¢å¯¹æ—¥ç›Šå¢é•¿çš„ç”¨æˆ·é‡å’Œæ•°æ®æ´ªæµè€Œæ˜¾å¾—åŠ›ä¸ä»å¿ƒæ—¶ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¾¿åº”è¿è€Œç”Ÿã€‚ç„¶è€Œï¼Œç³»ç»Ÿçš„åˆ†å¸ƒå¼æ¼”è¿›ä¹Ÿå¸¦æ¥äº†æ–°çš„æŒ‘æˆ˜ï¼šå¦‚ä½•åœ¨å¤šå°æœåŠ¡å™¨ä¹‹é—´é«˜æ•ˆã€å¿«é€Ÿåœ°å…±äº«å’Œè®¿é—®æ•°æ®ï¼Ÿ è¿™ç¯‡æ–‡ç« å°†å¸¦æ‚¨è®¤è¯†ä¸€ä¸ªåœ¨åˆ†å¸ƒå¼ä¸–ç•Œä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦è§’è‰²çš„æŠ€æœ¯â€”â€”Redisã€‚æˆ‘ä»¬å°†ä»æœ€åŸºç¡€çš„å•æœºæ¶æ„å‡ºå‘ï¼Œä¸€æ­¥æ­¥æ¢ç´¢ç³»ç»Ÿå¦‚ä½•æ¼”è¿›ä¸ºå¤æ‚çš„åˆ†å¸ƒå¼é›†ç¾¤ï¼Œå¹¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ­ç¤ºRedisä½œä¸ºé«˜æ€§èƒ½å†…å­˜æ•°æ®åº“å’Œç¼“å­˜ä¸­é—´ä»¶çš„æ ¸å¿ƒä»·å€¼ã€‚æ— è®ºæ‚¨æ˜¯åˆšå…¥é—¨çš„å¼€å‘è€…ï¼Œè¿˜æ˜¯å¸Œæœ›æ·±åŒ–å¯¹ç³»ç»Ÿæ¶æ„ç†è§£çš„å·¥ç¨‹å¸ˆï¼Œæœ¬æ–‡éƒ½å°†ä¸ºæ‚¨æä¾›ä¸€ä¸ªæ¸…æ™°çš„è·¯çº¿å›¾ï¼Œå¸®åŠ©æ‚¨ç†è§£Redisä¸ºä½•èƒ½æˆä¸ºç°ä»£é«˜æ€§èƒ½åº”ç”¨ä¸å¯æˆ–ç¼ºçš„åŸºçŸ³ã€‚ ...</div></div></div></a><a class="pagination-related" href="/2025/08/20/Redis/Redis%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E7%89%B9%E6%80%A7%E3%80%81%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5%E3%80%81%E6%8C%81%E4%B9%85%E5%8C%96%E4%B8%8E%E9%9B%86%E7%BE%A4%E5%AE%9E%E6%88%98/" title="Redisæ·±åº¦è§£æï¼šç‰¹æ€§ã€ç¼“å­˜ç­–ç•¥ã€æŒä¹…åŒ–ä¸é›†ç¾¤å®æˆ˜"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/08/20/Redis/Redis%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E7%89%B9%E6%80%A7%E3%80%81%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5%E3%80%81%E6%8C%81%E4%B9%85%E5%8C%96%E4%B8%8E%E9%9B%86%E7%BE%A4%E5%AE%9E%E6%88%98/3c9b78d0ad34dd35dfc885222b799e02.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">Redisæ·±åº¦è§£æï¼šç‰¹æ€§ã€ç¼“å­˜ç­–ç•¥ã€æŒä¹…åŒ–ä¸é›†ç¾¤å®æˆ˜</div></div><div class="info-2"><div class="info-item-1">ä¸€ã€Redis æ˜¯ä»€ä¹ˆ RedisÂ æ˜¯Remote Dictionary Server(Redis) çš„ç¼©å†™ï¼Œæ˜¯ä¸€ä¸ªä½¿ç”¨ Cè¯­è¨€ç¼–å†™ã€éµå®ˆBSDåè®®ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹çš„Key-Valueæ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„APIã€‚ å®ƒæ˜¯ä¸€ç§ NoSQLï¼ˆnot-only sqlï¼Œæ³›æŒ‡éå…³ç³»å‹æ•°æ®åº“ï¼‰çš„æ•°æ®åº“ï¼Œå¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯ä¸­é—´ä»¶ã€åˆ†å¸ƒå¼é”ç­‰ã€‚ äºŒã€Redis çš„ç‰¹ç‚¹å’ŒåŠŸèƒ½ æ€§èƒ½ä¼˜ç§€ï¼Œæ•°æ®åœ¨å†…å­˜ä¸­ï¼Œè¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œæ”¯æŒå¹¶å‘ 10W QPSï¼ˆæ¯ç§’æŸ¥è¯¢é‡ï¼‰ã€‚ å•è¿›ç¨‹å•çº¿ç¨‹ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé‡‡ç”¨ IO å¤šè·¯å¤ç”¨æœºåˆ¶ã€‚ ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼Œæ”¯æŒå­—ç¬¦ä¸²ï¼ˆstringsï¼‰ã€æ•£åˆ—ï¼ˆhashesï¼‰ã€åˆ—è¡¨ï¼ˆlistsï¼‰ã€é›†åˆï¼ˆsetsï¼‰ã€æœ‰åºé›†åˆï¼ˆsorted setsï¼‰ç­‰ã€‚ æ”¯æŒæ•°æ®æŒä¹…åŒ–ã€‚ å¯ä»¥å°†å†…å­˜ä¸­æ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œé‡å¯æ—¶åŠ è½½ã€‚ ä¸»ä»å¤åˆ¶ï¼Œå“¨å…µï¼Œé«˜å¯ç”¨ã€‚ å¯ä»¥ç”¨ä½œåˆ†å¸ƒå¼é”ã€‚ å¯ä»¥ä½œä¸ºæ¶ˆæ¯ä¸­é—´ä»¶ä½¿ç”¨ï¼Œæ”¯æŒå‘å¸ƒè®¢é˜… ...</div></div></div></a><a class="pagination-related" href="/2025/08/20/Redis/Redis%E7%9A%84%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/" title="Redisçš„å“¨å…µæ¨¡å¼åŸç†è¯¦è§£"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/08/20/Redis/Redis%E7%9A%84%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/73307303d8b5f6080d6ba616429b7e35.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">Redisçš„å“¨å…µæ¨¡å¼åŸç†è¯¦è§£</div></div><div class="info-2"><div class="info-item-1">Redisçš„å“¨å…µæ¨¡å¼åŸç†è¯¦è§£ å¼€ç¯‡ï¼šå“¨å…µæ¨¡å¼å°±åƒåŸå¸‚çš„åº”æ€¥æŒ‡æŒ¥ä¸­å¿ƒ æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ä¸ªç¹å¿™çš„åŸå¸‚äº¤é€šç³»ç»Ÿã€‚å½“ä¸»è¦äº¤é€šæ¢çº½å‡ºç°æ•…éšœæ—¶ï¼Œå¦‚æœæ²¡æœ‰åº”æ€¥æœºåˆ¶ï¼Œæ•´ä¸ªåŸå¸‚çš„äº¤é€šå°±ä¼šé™·å…¥ç˜«ç—ªã€‚è¿™æ—¶ï¼ŒåŸå¸‚çš„åº”æ€¥æŒ‡æŒ¥ä¸­å¿ƒå°±ä¼šå¯åŠ¨ï¼Œè‡ªåŠ¨æ£€æµ‹æ•…éšœã€åè°ƒå¤‡ç”¨è·¯çº¿ã€é€šçŸ¥ç›¸å…³éƒ¨é—¨ï¼Œç¡®ä¿åŸå¸‚äº¤é€šèƒ½å¤Ÿç»§ç»­è¿è¡Œã€‚ Redisçš„å“¨å…µ(Sentinel)æ¨¡å¼å°±æ˜¯è¿™æ ·ä¸€ä¸ª&quot;åº”æ€¥æŒ‡æŒ¥ä¸­å¿ƒ&quot;ã€‚åœ¨Redisä¸»ä»æ¶æ„ä¸­ï¼Œå¦‚æœä¸»èŠ‚ç‚¹(master)å‡ºç°æ•…éšœï¼Œå“¨å…µç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹åˆ°é—®é¢˜ï¼Œç„¶åä»ä»èŠ‚ç‚¹(slave)ä¸­é€‰ä¸¾å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶é€šçŸ¥æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥åˆ°æ–°çš„ä¸»èŠ‚ç‚¹ï¼Œç¡®ä¿RedisæœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥æ·±å…¥æ¢è®¨Rediså“¨å…µæ¨¡å¼çš„åŸç†ã€å·¥ä½œæœºåˆ¶å’Œå®ç°ç»†èŠ‚ã€‚é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œå¤§å®¶å°†äº†è§£åˆ°å“¨å…µæ¨¡å¼å¦‚ä½•ä¿éšœRedisçš„é«˜å¯ç”¨æ€§ï¼Œä»¥åŠåœ¨å®é™…é¡¹ç›®ä¸­å¦‚ä½•é…ç½®å’Œä½¿ç”¨å“¨å…µæ¨¡å¼ã€‚ ...</div></div></div></a><a class="pagination-related" href="/2025/10/10/Redis/Window%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%AE%89%E8%A3%85Redis/" title="Windowç¯å¢ƒä¸‹å®‰è£…Redis"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-10</div><div class="info-item-2">Windowç¯å¢ƒä¸‹å®‰è£…Redis</div></div><div class="info-2"><div class="info-item-1">ç”±äº Redis å®˜æ–¹æ²¡æœ‰æä¾› Windows åŸç”Ÿç‰ˆæœ¬ï¼Œè¿™é‡Œå°†ä»‹ç»å‡ ç§ä¸»æµçš„å®‰è£…æ–¹æ³•ã€‚ æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¾®è½¯ç§»æ¤çš„ Redisï¼ˆæœ€æ¨èã€æœ€ç¨³å®šï¼‰ è¿™æ˜¯æœ€é€‚åˆ Windows çš„å®‰è£…æ–¹å¼ï¼Œç”±å¾®è½¯å›¢é˜Ÿç»´æŠ¤ï¼Œæä¾›äº†ç¨³å®šçš„å®‰è£…åŒ…ã€‚ ä¸‹è½½ Redis è®¿é—® Redis åœ¨ GitHub çš„å‘å¸ƒé¡µé¢ï¼š https://github.com/microsoftarchive/redis/releases æ‰¾åˆ°æœ€æ–°çš„ç¨³å®šç‰ˆã€‚é€šå¸¸æ–‡ä»¶åæ ¼å¼ä¸º Redis-x64-3.0.504.msiï¼ˆç‰ˆæœ¬å·å¯èƒ½ä¸åŒï¼‰ã€‚ä¸‹è½½ .msi å®‰è£…æ–‡ä»¶ã€‚ å®‰è£… Redis è¿è¡Œå®‰è£…ç¨‹åºï¼šåŒå‡»ä¸‹è½½çš„ .msi æ–‡ä»¶ã€‚ åŒæ„è®¸å¯åè®®ï¼šå‹¾é€‰ â€œI accept the terms in the License Agreementâ€ï¼Œç„¶åç‚¹å‡» â€œNextâ€ã€‚ é€‰æ‹©å®‰è£…è·¯å¾„ï¼šå»ºè®®ä¿æŒé»˜è®¤è·¯å¾„ï¼ˆC:\Program Files\Redis\ï¼‰ï¼Œç‚¹å‡» â€œNextâ€ã€‚ é…ç½®ç«¯å£ï¼šé»˜è®¤ç«¯å£æ˜¯ 6379ï¼Œä¿æŒé»˜è®¤å³å¯ï¼Œç‚¹å‡» â€œNextâ€ã€‚ è®¾ç½®å†…å­˜é™åˆ¶ï¼šè¿™ä¸ªè®¾ç½®å¯ä»¥ä¿æŒé»˜è®¤ï¼Œç‚¹å‡» â€œNextâ€ã€‚ é‡è¦é…ç½®ï¼šåŠ¡å¿…å‹¾é€‰...</div></div></div></a></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/butterfly-icon.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">formeasy</div><div class="author-info-description">ä¸“æ³¨äº’è”ç½‘å’Œè½¯ä»¶æŠ€æœ¯</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">251</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">40</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/formeasy"><i class="fab fa-github"></i><span>å…³æ³¨æˆ‘</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/formeasy" target="_blank" title="Github"><i class="fab fa-github" style="color:#24292e"></i></a><a class="social-icon" href="mailto:formeasy@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color:#4a7dbe"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">ç”¨å­¦ä¹ ï¼Œé¢å¯¹é­é‡çš„å˜åŒ–ï¼›ç”¨æ–—å¿—ï¼Œé¢å¯¹æ¯å¤©çš„æŒ«æŠ˜ï¼›ç”¨åšæŒï¼Œé¢å¯¹å¤±å»çš„åŠ¨åŠ›!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E6%8C%91%E6%88%98"><span class="toc-number">1.</span> <span class="toc-text">ä¸€ã€ç¼“å­˜ä¸€è‡´æ€§æŒ‘æˆ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E5%BE%88%E9%9A%BE"><span class="toc-number">1.1.</span> <span class="toc-text">1. ä¸ºä»€ä¹ˆç¼“å­˜ä¸€è‡´æ€§å¾ˆéš¾ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%B8%80%E8%87%B4%E6%80%A7%E7%BA%A7%E5%88%AB%E5%AF%B9%E6%AF%94"><span class="toc-number">1.2.</span> <span class="toc-text">2. ä¸€è‡´æ€§çº§åˆ«å¯¹æ¯”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E5%9F%BA%E7%A1%80%E6%9B%B4%E6%96%B0%E7%AD%96%E7%95%A5"><span class="toc-number">2.</span> <span class="toc-text">äºŒã€åŸºç¡€æ›´æ–°ç­–ç•¥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-cache-aside%E6%A8%A1%E5%BC%8F%E6%97%81%E8%B7%AF%E7%BC%93%E5%AD%98"><span class="toc-number">2.1.</span> <span class="toc-text">1. Cache-Asideæ¨¡å¼ï¼ˆæ—è·¯ç¼“å­˜ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-write-through%E6%A8%A1%E5%BC%8F%E7%9B%B4%E5%86%99"><span class="toc-number">2.2.</span> <span class="toc-text">2. Write-Throughæ¨¡å¼ï¼ˆç›´å†™ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7%E6%96%B9%E6%A1%88"><span class="toc-number">3.</span> <span class="toc-text">ä¸‰ã€æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BB%B6%E8%BF%9F%E5%8F%8C%E5%88%A0%E7%AD%96%E7%95%A5"><span class="toc-number">3.1.</span> <span class="toc-text">1. å»¶è¿ŸåŒåˆ ç­–ç•¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9F%BA%E4%BA%8E%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E5%BC%82%E6%AD%A5%E6%9B%B4%E6%96%B0"><span class="toc-number">3.2.</span> <span class="toc-text">2. åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„å¼‚æ­¥æ›´æ–°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B-%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E6%96%B9%E6%A1%88"><span class="toc-number">4.</span> <span class="toc-text">å››ã€å¼ºä¸€è‡´æ€§æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%96%B9%E6%A1%88"><span class="toc-number">4.1.</span> <span class="toc-text">1. åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9F%BA%E4%BA%8Ebinlog%E7%9A%84%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88"><span class="toc-number">4.2.</span> <span class="toc-text">2. åŸºäºbinlogçš„åŒæ­¥æ–¹æ¡ˆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E5%9C%BA%E6%99%AF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">5.</span> <span class="toc-text">äº”ã€è¯»å†™åˆ†ç¦»åœºæ™¯çš„ä¸€è‡´æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%B8%BB%E4%BB%8E%E5%BB%B6%E8%BF%9F%E9%97%AE%E9%A2%98"><span class="toc-number">5.1.</span> <span class="toc-text">1. ä¸»ä»å»¶è¿Ÿé—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD-%E7%9B%91%E6%8E%A7%E4%B8%8E%E6%B2%BB%E7%90%86"><span class="toc-number">6.</span> <span class="toc-text">å…­ã€ç›‘æ§ä¸æ²»ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%B8%80%E8%87%B4%E6%80%A7%E7%9B%91%E6%8E%A7%E4%BD%93%E7%B3%BB"><span class="toc-number">6.1.</span> <span class="toc-text">1. ä¸€è‡´æ€§ç›‘æ§ä½“ç³»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%87%AA%E5%8A%A8%E4%BF%AE%E5%A4%8D%E6%9C%BA%E5%88%B6"><span class="toc-number">6.2.</span> <span class="toc-text">2. è‡ªåŠ¨ä¿®å¤æœºåˆ¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83-%E5%9C%BA%E6%99%AF%E5%8C%96%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">7.</span> <span class="toc-text">ä¸ƒã€åœºæ™¯åŒ–è§£å†³æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%94%B5%E5%95%86%E5%95%86%E5%93%81%E5%BA%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">7.1.</span> <span class="toc-text">1. ç”µå•†å•†å“åº“å­˜ä¸€è‡´æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%87%91%E8%9E%8D%E8%B4%A6%E6%88%B7%E4%BD%99%E9%A2%9D%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">7.2.</span> <span class="toc-text">2. é‡‘èè´¦æˆ·ä½™é¢ä¸€è‡´æ€§</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB-%E6%80%BB%E7%BB%93%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">8.</span> <span class="toc-text">å…«ã€æ€»ç»“ä¸æœ€ä½³å®è·µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E8%87%B4%E6%80%A7%E6%96%B9%E6%A1%88%E9%80%89%E6%8B%A9%E6%8C%87%E5%8D%97"><span class="toc-number">8.1.</span> <span class="toc-text">ä¸€è‡´æ€§æ–¹æ¡ˆé€‰æ‹©æŒ‡å—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-checklist"><span class="toc-number">8.2.</span> <span class="toc-text">æœ€ä½³å®è·µ checklist âœ…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%BB%BA%E8%AE%AE"><span class="toc-number">8.3.</span> <span class="toc-text">å…³é”®å»ºè®® ğŸš€</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/29/UE/UE%20Async%20Load%20Asset%E9%80%9A%E8%BF%87%E8%B5%84%E6%BA%90%E8%B7%AF%E5%BE%84%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E8%B5%84%E6%BA%90/" title="UE Async Load Asseté€šè¿‡èµ„æºè·¯å¾„åŠ¨æ€åŠ è½½èµ„æº"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2026/01/29/UE/UE%20Async%20Load%20Asset%E9%80%9A%E8%BF%87%E8%B5%84%E6%BA%90%E8%B7%AF%E5%BE%84%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E8%B5%84%E6%BA%90/111636_991.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="UE Async Load Asseté€šè¿‡èµ„æºè·¯å¾„åŠ¨æ€åŠ è½½èµ„æº"></a><div class="content"><a class="title" href="/2026/01/29/UE/UE%20Async%20Load%20Asset%E9%80%9A%E8%BF%87%E8%B5%84%E6%BA%90%E8%B7%AF%E5%BE%84%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E8%B5%84%E6%BA%90/" title="UE Async Load Asseté€šè¿‡èµ„æºè·¯å¾„åŠ¨æ€åŠ è½½èµ„æº">UE Async Load Asseté€šè¿‡èµ„æºè·¯å¾„åŠ¨æ€åŠ è½½èµ„æº</a><time datetime="2026-01-29T03:23:13.000Z" title="å‘è¡¨äº 2026-01-29 11:23:13">2026-01-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/22/UE/%E5%85%B3%E4%BA%8E%E9%A3%9E%E6%9C%BA%E7%9A%84%E7%BF%BC%E5%92%8C%E8%88%B5/" title="å…³äºé£æœºçš„ç¿¼å’Œèˆµ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2026/01/22/UE/%E5%85%B3%E4%BA%8E%E9%A3%9E%E6%9C%BA%E7%9A%84%E7%BF%BC%E5%92%8C%E8%88%B5/1c502f5433cdb915d54d957f374436c1.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="å…³äºé£æœºçš„ç¿¼å’Œèˆµ"></a><div class="content"><a class="title" href="/2026/01/22/UE/%E5%85%B3%E4%BA%8E%E9%A3%9E%E6%9C%BA%E7%9A%84%E7%BF%BC%E5%92%8C%E8%88%B5/" title="å…³äºé£æœºçš„ç¿¼å’Œèˆµ">å…³äºé£æœºçš„ç¿¼å’Œèˆµ</a><time datetime="2026-01-22T01:20:11.000Z" title="å‘è¡¨äº 2026-01-22 09:20:11">2026-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/19/UML/UML%E7%B1%BB%E5%9B%BE%E8%AF%A6%E8%A7%A3/" title="UMLç±»å›¾è¯¦è§£"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2026/01/19/UML/UML%E7%B1%BB%E5%9B%BE%E8%AF%A6%E8%A7%A3/9c7c3f64477366af39881fbdc38683d7.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="UMLç±»å›¾è¯¦è§£"></a><div class="content"><a class="title" href="/2026/01/19/UML/UML%E7%B1%BB%E5%9B%BE%E8%AF%A6%E8%A7%A3/" title="UMLç±»å›¾è¯¦è§£">UMLç±»å›¾è¯¦è§£</a><time datetime="2026-01-19T00:58:42.000Z" title="å‘è¡¨äº 2026-01-19 08:58:42">2026-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/17/UE/UE5%E6%95%B0%E6%8D%AE%E8%B5%84%E4%BA%A7%E3%80%81%E6%95%B0%E6%8D%AE%E8%A1%A8%E6%A0%BC%E5%92%8C%E5%AD%97%E7%AC%A6%E8%A1%A8%E6%A0%BC%E7%9A%84%E4%BD%BF%E7%94%A8/" title="UE5æ•°æ®èµ„äº§ã€æ•°æ®è¡¨æ ¼å’Œå­—ç¬¦è¡¨æ ¼çš„ä½¿ç”¨"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2026/01/17/UE/UE5%E6%95%B0%E6%8D%AE%E8%B5%84%E4%BA%A7%E3%80%81%E6%95%B0%E6%8D%AE%E8%A1%A8%E6%A0%BC%E5%92%8C%E5%AD%97%E7%AC%A6%E8%A1%A8%E6%A0%BC%E7%9A%84%E4%BD%BF%E7%94%A8/2026-01-17_133308_820.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="UE5æ•°æ®èµ„äº§ã€æ•°æ®è¡¨æ ¼å’Œå­—ç¬¦è¡¨æ ¼çš„ä½¿ç”¨"></a><div class="content"><a class="title" href="/2026/01/17/UE/UE5%E6%95%B0%E6%8D%AE%E8%B5%84%E4%BA%A7%E3%80%81%E6%95%B0%E6%8D%AE%E8%A1%A8%E6%A0%BC%E5%92%8C%E5%AD%97%E7%AC%A6%E8%A1%A8%E6%A0%BC%E7%9A%84%E4%BD%BF%E7%94%A8/" title="UE5æ•°æ®èµ„äº§ã€æ•°æ®è¡¨æ ¼å’Œå­—ç¬¦è¡¨æ ¼çš„ä½¿ç”¨">UE5æ•°æ®èµ„äº§ã€æ•°æ®è¡¨æ ¼å’Œå­—ç¬¦è¡¨æ ¼çš„ä½¿ç”¨</a><time datetime="2026-01-17T05:20:11.000Z" title="å‘è¡¨äº 2026-01-17 13:20:11">2026-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/10/UE/UE5-VR%E9%A1%B9%E7%9B%AEHDRIBackdrop%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" title="UE5-VRé¡¹ç›®HDRIBackdropæ— æ³•æ­£å¸¸æ˜¾ç¤ºé—®é¢˜è§£å†³"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2026/01/10/UE/UE5-VR%E9%A1%B9%E7%9B%AEHDRIBackdrop%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/c279d21ae76201f770cff811d5bc5b9b48676898.png@1192w.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="UE5-VRé¡¹ç›®HDRIBackdropæ— æ³•æ­£å¸¸æ˜¾ç¤ºé—®é¢˜è§£å†³"></a><div class="content"><a class="title" href="/2026/01/10/UE/UE5-VR%E9%A1%B9%E7%9B%AEHDRIBackdrop%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" title="UE5-VRé¡¹ç›®HDRIBackdropæ— æ³•æ­£å¸¸æ˜¾ç¤ºé—®é¢˜è§£å†³">UE5-VRé¡¹ç›®HDRIBackdropæ— æ³•æ­£å¸¸æ˜¾ç¤ºé—®é¢˜è§£å†³</a><time datetime="2026-01-10T07:41:29.000Z" title="å‘è¡¨äº 2026-01-10 15:41:29">2026-01-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2026 By formeasy</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="å‰å¾€è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(async()=>{window.katex_js_css||(window.katex_js_css=!0,await btf.getCSS("https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"),await btf.getScript("https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js")),document.querySelectorAll("#article-container .katex").forEach(t=>t.classList.add("katex-show"))})()</script><script>(()=>{var e=()=>{var e;0!==(e=document.querySelectorAll("pre > code.mermaid")).length&&e.forEach(e=>{var t=document.createElement("pre"),n=(t.className="mermaid-src",t.hidden=!0,t.textContent=e.textContent,document.createElement("div"));n.className="mermaid-wrap",n.appendChild(t),e.parentNode.replaceWith(n)});const t=document.querySelectorAll("#article-container .mermaid-wrap");0!==t.length&&(e=()=>{{var e=t;window.loadMermaid=!0;const a="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";e.forEach((e,t)=>{const n=e.firstElementChild;e=`%%{init:{ 'theme':'${a}'}}%%
`+n.textContent,t=mermaid.render("mermaid-"+t,e);const d=e=>{n.insertAdjacentHTML("afterend",e)};"string"==typeof t?d(t):t.then(({svg:e})=>d(e))})}},btf.addGlobalFn("themeChange",e,"mermaid"),window.loadMermaid?e():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js").then(e))};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{const a=GLOBAL_CONFIG_SITE.isShuoshuo,s=null,n=t=>"dark"===t?"dark":"light";var t=(t=document,e)=>{e=a?{"data-mapping":"specific","data-term":e}:{"data-mapping":(s,"pathname")},e=(t=>{const a=document.createElement("script");return Object.entries(t).forEach(([t,e])=>{a.setAttribute(t,e)}),a})({src:"https://giscus.app/client.js","data-repo":"formeasy/blog","data-repo-id":"R_kgDOJ2sA5A","data-category-id":"DIC_kwDOJ2sA5M4CktKh","data-theme":n(document.documentElement.getAttribute("data-theme")),"data-reactions-enabled":"1",crossorigin:"anonymous",async:!0,...s,...e});t.querySelector("#giscus-wrap").appendChild(e),a&&(window.shuoshuoComment.destroyGiscus=()=>{t.children.length&&(t.innerHTML="",t.classList.add("no-comment"))})};btf.addGlobalFn("themeChange",t=>{var e=document.querySelector("#giscus-wrap iframe");e&&(t={giscus:{setConfig:{theme:n(t)}}},e.contentWindow.postMessage(t,"https://giscus.app"))},"giscus"),a?window.shuoshuoComment={loadComment:t}:t()})()</script></div><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="false" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> æ•°æ®åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="è¯·è¾“å…¥æœç´¢å…³é”®å­—" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>